<script type="module" src="api-server.js"></script>
<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<title>Äta Tillsammans - Profil</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="styles.css">
<link rel="icon" type="image/png" sizes="128x128" href="logowebb.png">

<style>
body { font-family: 'Poppins', sans-serif; background:#fafafa; margin:0; color:#333; }
.navbar { display:flex; align-items:center; justify-content:space-between; background:black; color:white; padding:10px 20px; position:sticky; top:0; z-index:1000; }
.navbar .logo img { height:50px; }
.navbar .icon { cursor:pointer; font-size:24px; display:flex; align-items:center; }
.navbar .icon img { height:35px; width:35px; margin-left:15px; }
.dropdown { display:none; position:absolute; top:60px; right:15px; background:black; width:140px; border-radius:6px; z-index:1001; }
.dropdown a { display:block; padding:12px; color:white; text-decoration:none; }
.dropdown a:hover { background:#333; }
.hero { height:40vh; background:url('hero.jpg') center/cover no-repeat; position:relative; color:white; }
.hero-content { position:absolute; bottom:20px; left:40px; }
.hero h1 { font-size:48px; margin:0; }
.profile-section { display:flex; justify-content:center; padding:50px 20px; gap:40px; flex-wrap:wrap; }
.container { background:white; padding:40px; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,.1); max-width:350px; width:100%; text-align:center; }
.tabs { display:flex; margin-bottom:20px; }
.tabs button { flex:1; padding:10px; border:none; background:none; cursor:pointer; border-bottom:2px solid transparent; }
.tabs button.active { border-bottom:2px solid black; font-weight:600; }
.form { display:none; flex-direction:column; }
.form.active { display:flex; }
.form input { margin-bottom:15px; padding:10px; border-radius:6px; border:1px solid #ccc; }
.form button { padding:12px; border:none; border-radius:6px; background:black; color:white; cursor:pointer; }
#profileAvatar { width:90px; height:90px; border-radius:50%; border:3px solid #222; display:flex; align-items:center; justify-content:center; font-size:32px; margin:15px auto; }
.profile-table { width:100%; border-collapse:collapse; }
.profile-table td { padding:10px; border-bottom:1px solid #eee; }
.profile-table td:first-child { text-align:left; font-weight:600; }
.profile-table td:last-child { text-align:right; }
.info button { margin-top:20px; padding:12px; border:none; border-radius:6px; background:black; color:white; cursor:pointer; }
</style>
</head>

<body>
  
<script>
// global app state
const AppState = {
  userId: -1,
}

// call API
const serverAddress = "http://localhost:3123";
</script>

<div class="navbar">
  <div class="icon" id="menuToggle">☰</div>
  <div class="logo"><a href="index.html"><img src="logo.png"></a></div>
  <div class="icon"><a href="profile.html"><img src="profile.png"></a></div>
</div>

<div class="dropdown" id="menu">
  <a href="index.html">Hem</a>
  <a href="activities.html">Hitta & Boka</a>
  <a href="index.html#about">Om oss</a>
  <a href="profile.html">Min Profil</a>
</div>

<section class="hero">
  <div class="hero-content">
    <h1>Konto</h1>
  </div>
</section>

<div class="profile-section">

  <!-- LOGIN / REGISTER -->
  <div class="container" id="authContainer">
    <h1>Äta Tillsammans</h1>
    <p>Skapa konto / Logga in</p>

    <div class="tabs">
      <button id="loginTab" class="active">Logga in</button>
      <button id="registerTab">Skapa konto</button>
    </div>

    <form id="loginForm" class="form active">
      <input id="loginEmail" type="email" placeholder="E-post" required>
      <input id="loginPassword" type="password" placeholder="Lösenord" required>
      <button type="submit">Logga in</button>
    </form>

    <form id="registerForm" class="form">
      <input id="firstName" placeholder="Förnamn" required>
      <input id="lastName" placeholder="Efternamn" required>
      <input id="age" placeholder="Ålder" required>
      <input id="city" placeholder="Stad" required>
      <input id="registerEmail" type="email" placeholder="E-post" required>
      <input id="registerPassword" type="password" placeholder="Lösenord" required>
      <button type="submit">Skapa konto</button>
    </form>
  </div>

  <!-- PROFILE -->
  <div class="container" id="profileCard" style="display:none;">
    <div id="profileAvatar"></div>
    <table class="profile-table">
      <tr><td>Namn</td><td id="profileName"></td></tr>
      <tr><td>Ålder</td><td id="profileAge"></td></tr>
      <tr><td>Email</td><td id="profileEmail"></td></tr>
      <tr><td>Stad</td><td id="profileCity"></td></tr>
    </table>
    <div class="info">
      <button id="logoutBtn">Logga ut</button>
    </div>
  </div>

</div>

<script src="api-server.js"></script>
<script>
  // --- Navbar dropdown ---
  const menuToggle = document.getElementById("menuToggle");
  const menu = document.getElementById("menu");
  menuToggle.addEventListener("click", () => {
    menu.style.display = menu.style.display === "block" ? "none" : "block";
  });

  // --- Tabs ---
  const loginTab = document.getElementById("loginTab");
  const registerTab = document.getElementById("registerTab");
  const loginForm = document.getElementById("loginForm");
  const registerForm = document.getElementById("registerForm");

  function showForm(type) {
    loginForm.classList.toggle("active", type === "login");
    registerForm.classList.toggle("active", type === "register");
    loginTab.classList.toggle("active", type === "login");
    registerTab.classList.toggle("active", type === "register");
  }

  loginTab.addEventListener("click", () => showForm("login"));
  registerTab.addEventListener("click", () => showForm("register"));

  // --- Elements ---
  const authContainer = document.getElementById("authContainer");
  const profileCard = document.getElementById("profileCard");
  const loginEmail = document.getElementById("loginEmail");
  const loginPassword = document.getElementById("loginPassword");
  const firstName = document.getElementById("firstName");
  const lastName = document.getElementById("lastName");
  const age = document.getElementById("age");
  const city = document.getElementById("city");
  const registerEmail = document.getElementById("registerEmail");
  const registerPassword = document.getElementById("registerPassword");
  const profileName = document.getElementById("profileName");
  const profileAge = document.getElementById("profileAge");
  const profileEmail = document.getElementById("profileEmail");
  const profileCity = document.getElementById("profileCity");
  const profileAvatar = document.getElementById("profileAvatar");
  const logoutBtn = document.getElementById("logoutBtn");

  // --- Register ---
  registerForm.addEventListener("submit", async e => {
    e.preventDefault();
    try {
      await register({
        firstName:firstName.value,
        lastName:lastName.value,
        age:age.value,
        city:city.value,
        email:registerEmail.value,
        password:registerPassword.value
      });
      alert("Konto skapat!");
      showForm("login");
    } catch(err) { alert(err.message); }
  });

 

  function showProfile(user) {
    profileName.textContent = user.firstName + " " + user.lastName;
    profileAge.textContent = user.age;
    profileEmail.textContent = user.email;
    profileCity.textContent = user.city;
    profileAvatar.textContent = (user.firstName[0]||'')+(user.lastName[0]||'');
    authContainer.style.display="none";
    profileCard.style.display="block";
  }

  // --- Logout ---
  logoutBtn.addEventListener("click", async () => {
    await window.logout();
    localStorage.removeItem("userId");
    authContainer.style.display="block";
    profileCard.style.display="none";
  });

  // --- Auto-login ---
  window.addEventListener("load", async () => {
    try {
      const id = localStorage.getItem("userId");
      if(!id) return;
      const profile = await window.getProfile();
      if(profile) showProfile(profile);
    } catch(err) { console.error(err); }
  });
</script>




</script>

</body>
</html>

<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<title>Hitta & Boka</title>
<link rel="stylesheet" href="styles.css">
<link rel="icon" type="image/png" sizes="128x128" href="logowebb.png">
<style>
body { font-family: 'Poppins', sans-serif; background-color: #fafafa; margin:0; color:#333; }
.group-section { max-width:1200px; margin:50px auto; padding:20px; }
.group-section h2 { text-align:center; margin-bottom:25px; font-weight:600; color:#333; }
.group-layout { display:grid; grid-template-columns:1fr 1fr; gap:40px; }
.create-group { background:transparent; padding:25px; margin-bottom:35px; box-shadow:0 4px 12px rgba(0,0,0,0.05); display:flex; flex-direction:column; align-items:center; }
.create-group form { width:100%; max-width:500px; display:flex; flex-direction:column; gap:12px; }
.create-group input, .create-group button { padding:12px; border:2px solid #333; }
.group-list { padding:25px; box-shadow:0 4px 12px rgba(0,0,0,0.05); }
.search-input { width:100%; padding:12px; border:2px solid #333; margin-bottom:20px; }
.group-card { border:2px solid #333; padding:20px; margin-bottom:15px; }
.chat-btn { padding:10px; border:2px solid green; background:transparent; color:green; cursor:pointer; }
</style>
</head>
<body>

<script>
/* -------- GLOBAL STATE -------- */
const AppState = {
  userId: -1
}

const serverAddress = "http://localhost:3123"

/* -------- ACTIVITY API -------- */
async function getActivities() {
  const res = await fetch(`${serverAddress}/activity`)
  if (!res.ok) throw new Error("Kunde inte hämta träffar")
  return res.json()
}

async function createActivity(data) {
  const res = await fetch(`${serverAddress}/activity`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(data)
  })
  if (!res.ok) throw new Error("Kunde inte skapa träff")
  return res.json()
}

/* -------- MOCK USER (tills login är klart) -------- */
async function getProfile() {
  // tillfällig användare
  return { id: 1, firstName: "Test" }
}
</script>

<!-- NAVBAR -->
<div class="navbar">
  <div class="icon" id="menuToggle">☰</div>
  <div class="logo"><a href="index.html"><img src="logo.png" alt="Logo"></a></div>
  <div class="icon"><a href="profile.html"><img src="profile.png" alt="Profil"></a></div>
</div>

<div class="dropdown" id="menu">
  <a href="index.html">Hem</a>
  <a href="activities.html">Hitta & Boka</a>
  <a href="index.html#about">Om oss</a>
  <a href="profile.html">Min Profil</a>
</div>

<section class="hero">
  <div class="hero-content">
    <h1>Hitta & Boka</h1>
  </div>
</section>

<section class="group-section">
<h2>Skapa eller gå med i träffar</h2>
<div class="group-layout">

  <!-- SKAPA TRÄFF -->
  <div class="create-group">
    <h3>Skapa en ny träff</h3>
    <form id="createGroupForm">
      <input id="groupName" placeholder="Träffens namn" required>
      <input id="groupCity" placeholder="Stad" required>
      <input id="groupAdress" placeholder="Adress" required>
      <input id="groupTime" type="datetime-local" required>
      <input id="groupLimit" type="number" placeholder="Platser" min="1" required>
      <button type="submit">Skapa träff</button>
      <p id="loginMessage" style="color:red; display:none; margin-top:10px;">
        Du måste vara inloggad för att skapa en träff!
      </p>
    </form>
  </div>

  <!-- LISTA TRÄFFAR -->
  <div class="group-list">
    <h3>Alla träffar</h3>
    <input id="searchInput" class="search-input" placeholder="Sök träff...">
    <div id="groupsContainer"></div>
  </div>

</div>
</section>

<script>
document.addEventListener("DOMContentLoaded", async () => {
  const menuToggle = document.getElementById("menuToggle")
  const menu = document.getElementById("menu")
  const groupsContainer = document.getElementById("groupsContainer")
  const searchInput = document.getElementById("searchInput")
  const createForm = document.getElementById("createGroupForm")
  const loginMessage = document.getElementById("loginMessage")

  menuToggle.onclick = () => {
    menu.style.display = menu.style.display === "block" ? "none" : "block"
  }

  let currentUser = await getProfile()
  let groups = []

  /* -------- HÄMTA TRÄFFAR -------- */
  async function fetchGroups() {
    try {
      groups = await getActivities()
      renderGroups()
    } catch (e) {
      console.error(e)
    }
  }

  /* -------- RENDERA TRÄFFAR -------- */
  function renderGroups() {
    groupsContainer.innerHTML = ""
    groups.forEach(group => {
      const card = document.createElement("div")
      card.className = "group-card"
      card.setAttribute("data-name", group.name.toLowerCase())

      card.innerHTML = `
        <h3>${group.name}</h3>
        <p>${new Date(group.time).toLocaleString("sv-SE")}</p>
        <p>${group.seats} platser</p>
        <a href="group.html?id=${group.id}">
          <button class="chat-btn">Visa träff</button>
        </a>
      `
      groupsContainer.appendChild(card)
    })
  }

  /* -------- SKAPA TRÄFF -------- */
  createForm.addEventListener("submit", async e => {
    e.preventDefault()

    if (!currentUser) {
      loginMessage.style.display = "block"
      return
    }

    const name = groupName.value
    const time = groupTime.value
    const seats = Number(groupLimit.value)

    try {
      await createActivity({
        name,
        time,
        seats,
        locationId: 1,
        creatorId: currentUser.id
      })

      createForm.reset()
      loginMessage.style.display = "none"
      fetchGroups()
    } catch (err) {
      alert(err.message)
    }
  })

  /* -------- SÖK -------- */
  searchInput.addEventListener("input", e => {
    const q = e.target.value.toLowerCase()
    document.querySelectorAll(".group-card").forEach(card => {
      card.style.display = card.dataset.name.includes(q) ? "block" : "none"
    })
  })

  fetchGroups()
})
</script>

<footer style="background:#222; color:#fff; text-align:center; padding:20px; font-size:14px;">
  <p>© 2026 Äta Tillsammans. Alla rättigheter förbehållna.</p>
</footer>

</body>
</html>

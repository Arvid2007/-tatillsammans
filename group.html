<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<title>Träff</title>
<link rel="stylesheet" href="styles.css">
<link rel="icon" type="image/png" sizes="128x128" href="logowebb.png">
<style>
body { font-family: 'Poppins', sans-serif; background-color: #fafafa; margin: 0; color: #333; }
.navbar { display: flex; align-items: center; padding: 10px 20px; background: #fff; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
.navbar .logo img { height: 40px; }
.navbar .icon img { height: 32px; cursor: pointer; margin-left: auto; }
.dropdown { display: none; flex-direction: column; position: absolute; top: 60px; right: 20px; background: white; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
.dropdown a { padding: 10px 20px; text-decoration: none; color: #333; }
.group-section { max-width: 900px; margin: 50px auto; padding: 20px; background: #fff; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
.group-header h2 { margin: 0 0 10px 0; }
.group-header p { margin: 2px 0 15px 0; color: #666; }
.participants, .messages { margin-bottom: 20px; }
.participants { display: flex; flex-wrap: wrap; gap: 8px; align-items: center; }
.participants strong { margin-right: 10px; }
.avatar { width: 34px; height: 34px; border-radius: 50%; background: black; color: white; display: flex; align-items: center; justify-content: center; font-size: 13px; }
.message { margin-bottom: 10px; }
.message strong { margin-right: 5px; }
.chat-box { display: flex; gap: 8px; }
.chat-box input { flex: 1; padding: 10px; border: 2px solid #333; }
.chat-box button { padding: 10px 15px; border: 2px solid #333; background: transparent; cursor: pointer; }
.leave-btn { padding: 10px 15px; border: 2px solid red; background: transparent; color: red; cursor: pointer; margin-top: 10px; }
</style>
</head>
<body>

<script>
// global app state
const AppState = {
  userId: -1,
}

// call API
const serverAddress = "http://localhost:3123";
</script>

<!-- NAVBAR -->
<div class="navbar">
  <div class="icon" onclick="toggleMenu()">☰</div>
  <div class="logo"><a href="index.html"><img src="logo.png"></a></div>
  <div class="icon"><a href="profile.html"><img src="profile.png"></a></div>
</div>

<div class="dropdown" id="menu">
  <a href="index.html">Hem</a>
  <a href="activities.html">Hitta & Boka</a>
  <a href="index.html#about">Om oss</a>
  <a href="profile.html">Min Profil</a>
</div>

<section class="group-section">
  <div class="group-header">
    <h2 id="groupName">Träff</h2>
    <p id="groupInfo">Stad • Datum</p>
  </div>

  <div class="participants">
    <strong>Deltagare:</strong>
    <div id="participantsContainer"></div>
  </div>

  <div class="messages">
    <strong>Chatt:</strong>
    <div id="messagesContainer" style="max-height:300px; overflow-y:auto;"></div>
  </div>

  <div class="chat-box">
    <input type="text" id="chatInput" placeholder="Skriv meddelande...">
    <button id="sendBtn">Skicka</button>
  </div>

  <button class="leave-btn" id="leaveBtn">Lämna träff</button>
</section>

<script src="api-server.js"></script>
<script>
function toggleMenu() {
  const menu = document.getElementById("menu");
  menu.style.display = menu.style.display === "block" ? "none" : "block";
}

// --- Init ---
const urlParams = new URLSearchParams(window.location.search);
const groupId = urlParams.get("id");

let currentUser = null;
let currentGroup = { name: "Träff", city: "Stad", time: Date.now(), members: [], messages: [] };

// Hämta aktuell användare
async function initUser() {
  try {
    currentUser = await getProfile(); // från api.js
    if(!currentUser) alert("Du måste vara inloggad för att delta i träffen!");
  } catch(e) { console.error(e); }
}

// Hämta gruppdata
async function fetchGroup() {
  // Placeholder – ersätt med backend när det är klart
  // Exempel: currentGroup = await getGroup(groupId);
  return currentGroup;
}

// Rendera grupp
function renderGroup() {
  const participantsContainer = document.getElementById("participantsContainer");
  participantsContainer.innerHTML = "";
  currentGroup.members.forEach(member => {
    const avatar = document.createElement("div");
    avatar.className = "avatar";
    avatar.textContent = member.name[0];
    avatar.title = member.name;
    participantsContainer.appendChild(avatar);
  });

  const messagesContainer = document.getElementById("messagesContainer");
  messagesContainer.innerHTML = "";
  currentGroup.messages.forEach(msg => {
    const div = document.createElement("div");
    div.className = "message";
    div.innerHTML = `<strong>${msg.user}:</strong> ${msg.text}`;
    messagesContainer.appendChild(div);
  });

  document.getElementById("groupName").textContent = currentGroup.name;
  document.getElementById("groupInfo").textContent = `${currentGroup.city} • ${new Date(currentGroup.time).toLocaleString("sv-SE")}`;
}

// Skicka meddelande
document.getElementById("sendBtn").addEventListener("click", () => {
  const text = document.getElementById("chatInput").value.trim();
  if(!text || !currentUser) return;
  currentGroup.messages.push({ user: currentUser.firstName, text });
  document.getElementById("chatInput").value = "";
  renderGroup();
});

// Enter för att skicka
document.getElementById("chatInput").addEventListener("keydown", e => {
  if(e.key === "Enter") document.getElementById("sendBtn").click();
});

// Lämna träff
document.getElementById("leaveBtn").addEventListener("click", () => {
  if(!currentUser) return;
  if(confirm("Är du säker på att du vill lämna träffen?")) {
    currentGroup.members = currentGroup.members.filter(m => m.id !== currentUser.id);
    renderGroup();
    window.location.href = "activities.html";
  }
});

// Init
(async () => {
  await initUser();
  currentGroup = await fetchGroup();
  renderGroup();
})();
</script>

<footer style="background:#222; color:#fff; text-align:center; padding:20px; font-size:14px;">
  <p>© 2026 Äta Tillsammans. Alla rättigheter förbehållna.</p>
  <p>Kontakt: info@atatillsammans.se | Tel: 08-123 456 78</p>
  <p>
    <a href="privacy.html" style="color:#fff; text-decoration:underline;">Integritetspolicy</a> | 
    <a href="terms.html" style="color:#fff; text-decoration:underline;">Användarvillkor</a>
  </p>
  <p>Följ oss: 
    <a href="#" style="color:#fff;">Facebook</a> | 
    <a href="#" style="color:#fff;">Instagram</a>
  </p>
</footer>
</body>
</html>
